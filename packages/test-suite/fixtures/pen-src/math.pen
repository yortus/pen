/*
 * egs:
 *      2+3*5
 *      42*(333.3-2e17)
 *      0xff+0x100
 *      %1001+%0011
 */


(memoise, floatString, intString) = import 'std'


start = expr


expr = memoise(add | sub | term)
add = {type = ab"add", lhs = expr, rhs = co"+" term}
sub = {type = ab"sub", lhs = expr, rhs = co"-" term}

term = memoise(mul | div | factor)
mul = { // test both dynamic and static field names exprs
    [ab"type"] = ab"mul",
    lhs = term,
    [ab"rhs"] = co"*" factor
}
div = {
    type = (ab)"div",
    lhs = term,
    rhs = (co)"/" factor,
}

factor =
    | !"0x"   !"0b"   floatString
    | (co)"0x"   intString(base=16 signed=false)
    | (co)"0b"   intString(base=2 signed=false)
    | (co)"i"    intString(signed=false)
    | (co)"("   expr   (co)")"

ab = expr -> abstract expr
co = expr -> concrete expr
