/*
 * egs:
 *      2+3*5
 *      42*(333.3-2e17)
 *      0xff+0x100
 *      %1001+%0011
 */


(memoise, floatString, intString) = import 'std'


start = expr


expr = memoise(add | sub | term)
add = {type = abstract "add", lhs = expr, rhs = concrete "+" term}
sub = {type = abstract "sub", lhs = expr, rhs = concrete "-" term}

term = memoise(mul | div | factor)
mul = { // test both dynamic and static field names exprs
    [abstract "type"] = abstract "mul",
    lhs = term,
    [abstract "rhs"] = concrete "*" factor
}
div = {
    type = abstract "div",
    lhs = term,
    rhs = concrete "/" factor,
}

factor =
    | !"0x"   !"0b"   floatString
    | concrete "0x"   intString(base=16 signed=false)
    | concrete "0b"   intString(base=2 signed=false)
    | concrete "i"    intString(signed=false)
    | concrete "("   expr   concrete ")"
