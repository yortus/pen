## Compile Target

#### Compiler Inputs
- `*.pen` source files
- `*.d.pen` declaration files describing `.ts` source files ('extensions')
- `*.ts` extension source files (not parsed, maybe just copied)

#### General Considerations
- end user wants a `parse` and an `unparse` function for the given PEN grammar, consumable from JS/TS code
- end user wants a command-line parser/unparser too? Do this later, or first?
- should be able to import the `parse` and `unparse` functions into a JS/TS project in Node.js
- `parse`/`unparse` should be strongly-typed in TypeScript (meaning implied AST is completely typed)

#### Compile Target
- runtime: Node.js
- format: ES6 module
- structure:
    - npm package - i.e. a directory of files
    - `package.json`
        - `main` and `typings` fields
        - deps: `penc` for std lib, `commander` for CLI usage?
        - scripts?
        - bin wrapper script to support CLI usage?
    - `src/` dir
        - one `.ts` file per input `.pen` file, mirroring input file/dir structure
        - ...these `.ts` files include static types for all AST nodes / rules
        - a copy of each input `.ts` 'extension` file that corresponds to an input `.d.pen` declaration file (error if missing)
    - `dist/` dir
        - output `.js` and `.d.ts` files generated by `tsc`
- to be consumable in a host JS/TS project, there are two options:
    1. output of `penc` get included in `src/` of host project (which compiles it in to the host project)
        - inflexible
        - with this option `penc` doesn't produce a working parser/unparser, just more source code for another transpiler
        - needs a host project
    2. output of `penc` is an npm module that can be imported at runtime by host project
        - flexible
        - can publish the output module to npm as a standalone package
        - can make a single-file exe out of the output package (eg using `zeit/pkg`)
        - can add the output package to an existing monorepo for symlinked import/require by sister packages
        - can embed the package within a single host package and list it as a local file dep
            - eg `"dependencies": { "foo-parser": "file:dist/foo-parser", ... }`
            - ...where the (pre)build script invokes `penc <foo grammar opts> --out dist/foo-parser`
        - requires that `penc` itself embeds `tsc` and runs it to produce the final package (so internally two transpile steps)
            - at least this means `penc` can report extra checks by `tsc` - eg that 'extension' files match their `.d.pen` declarations

#### Implementation Notes
- idea: use `memfs` to delay/avoid writing intermediate output to disk
